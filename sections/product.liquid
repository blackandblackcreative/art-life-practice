{% comment %} Translations {% endcomment %}
{% assign product_media_t = 'products.product_media' | t %}
{% assign image_modal_t = 'products.image_modal' | t %}

{% comment %} Variables {% endcomment %}
{% assign current_variant = product.selected_or_first_available_variant %}
{% assign featured_media = current_variant.featured_media | default: product.featured_media %}
{% assign hide_variant_media = section.settings.hide-variant-media %}
{% assign modal_enabled = section.settings.modal-enabled %}
{% assign low_stock_amount = section.settings.low-in-stock-amount %}
{% assign pickup_enabled = section.settings.product-pickup-enabled %}
{% assign show_social_share = settings.social--share-products %}
{% assign show_unavailable_form = section.settings.product-unavailable-form-show %}
{% assign smart_payment_enabled = section.settings.smart-payment-button %}
{% assign size_chart_enabled = section.settings.product-size-chart-enabled %}
{% assign size_chart_content = section.settings.product-size-chart-page-content %}
{% assign size_chart_option = section.settings.product-size-chart-option %}
{% assign swatches_enabled = section.settings.swatches-enabled %}
{% assign variant_style = section.settings.variant-style %}
{% assign video_looping_enabled = section.settings.loop-enabled %}

{%- capture variant_media_ids -%}
  {%- for variant in product.variants -%}
    '{{- variant.featured_media.id -}}',
  {%- endfor -%}
{%- endcapture -%}
{% assign variant_media_ids = variant_media_ids | split: ',' %}

<div
  class="product-page--root"
  data-section-id="{{ section.id }}"
  data-section-type="product_page"
  data-js-class="Product"
>

  {% if modal_enabled %}
    <div class="modal--root" data-js-class="FrameworkModal">
  {% endif %}

    <div class="product-page--top-panel">
      <div class="product-page--panel-wrapper">

        <div class="product-page--featured-media">
          {% if modal_enabled and featured_media.media_type == 'image' %}
            <a class="modal--link" href="#" aria-label="{{ image_modal_t }}">
          {% endif %}

          {%
            render "framework--product--media",
            view: "featured",
            product_media: featured_media,
            video_looping_enabled: video_looping_enabled
          %}

          {% if modal_enabled and featured_media.media_type == 'image' %}
            </a>
          {% endif %}

          {%
            render "framework--product--media",
            view: "media-dependencies",
            product: product
          %}
        </div>

        <div class="product-page--form-container">
          <a href="{{ product.url }}">
            <h1 data-item="section-heading">{{ product.title }}</h1>
          </a>

          {%
            render "framework--product--form",
            product: product,
            callback_enabled: true,
            low_stock_amount: low_stock_amount,
            pickup_enabled: pickup_enabled,
            smart_payment_enabled: smart_payment_enabled,
            size_chart_enabled: size_chart_enabled,
            size_chart_content: size_chart_content,
            size_chart_option: size_chart_option,
            show_unavailable_form: show_unavailable_form,
            swatches_enabled: swatches_enabled,
            variant_style: variant_style
          %}
        </div>

      </div>
    </div>

    <div class="product-page--content">
      <div class="product-page--column-container">
        <div class="product-page--column-left"></div>
        <div class="product-page--column-right"></div>
      </div>

      <div class="product-page--single-column">
        <div
          class="product-page--description"
          data-item="rte-content"
          itemprop="description"
        >
          {% render 'product-description-tabs', product: product %}
        </div>

        {% for media in product.media %}
          {% if media == featured_media %}
            {% continue %}
          {% endif %}

          {%- capture media_id -%}'{{ media.id }}'{%- endcapture -%}

          {% if hide_variant_media and variant_media_ids contains media_id %}
            <a class="product-page--hidden-variant" aria-label="{{ product_media_t }}">
              {%
                render "framework--product--media",
                view: "featured",
                product_media: media,
                video_looping_enabled: video_looping_enabled
              %}
            </a>

            {% continue %}
          {% endif %}

          <div class="product-page--media-variant">

            {% if modal_enabled and media.media_type == 'image' %}
              <a class="modal--link" tabindex="0" aria-label="{{ product_media_t }}">
            {% endif %}

            {%
              render "framework--product--media",
              view: "featured",
              product_media: media,
              video_looping_enabled: video_looping_enabled
            %}

            {% if modal_enabled and media.media_type == 'image' %}
              </a>
            {% endif %}

          </div>

        {% endfor %}

      </div>
    </div>

  {% if modal_enabled %}
      <div class="product-page--modal-wrapper">
        {% for media in product.media %}
          {% if media.media_type == "image" %}
            <div class="modal--content">
              <div class="product-page--modal-image" data-id="{{ media.id }}">
                {% render 'framework--image', image: media %}
              </div>
            </div>
          {% endif %}
        {% endfor %}
      </div>

    </div>
  {% endif %}

  {% if show_social_share %}
    {% render 'partial--social-share', view: 'product' %}
  {% endif %}

</div>

{% schema %}
{
  "name": "Product page",
  "settings": [
    {
      "type": "checkbox",
      "id": "smart-payment-button",
      "label": "Show dynamic checkout button",
      "info": "Lets customers check out directly using a familiar payment method. [Learn more](https://help.shopify.com/manual/using-themes/change-the-layout/dynamic-checkout)",
      "default": true
    },
    {
      "type": "select",
      "id": "variant-style",
      "label": "Product variant style",
      "options": [
        { "label": "Dropdowns", "value": "dropdowns" },
        { "label": "Buttons", "value": "buttons" }
      ],
      "default": "dropdowns"
    },
    {
      "type": "checkbox",
      "id": "swatches-enabled",
      "label": "Enable color swatches",
      "default": false,
      "info": "Automatically turn color options into swatches. [Learn more](https://support.troopthemes.com/guide/color-swatch-guide)"
    },
    {
      "type": "checkbox",
      "id": "product-unavailable-form-show",
      "label": "Show notification form when product is unavailable"
    },
    {
      "label": "Show low in stock notice when quantity is",
      "id": "low-in-stock-amount",
      "type": "range",
      "min": 0,
      "max": 10,
      "step": 1,
      "default": 0,
      "info": "Set to 0 to disable this feature. Updated for each variant."
    },
    {
      "type": "checkbox",
      "id": "product-pickup-enabled",
      "label": "Enable product pickup",
      "default": true,
      "info": "Learn more about [local pickup](https://help.shopify.com/en/manual/sell-in-person/pos-classic/shopify-pos-from-admin/buy-online-pickup-in-store)."
    },
    {
      "type": "header",
      "content": "Media"
    },
    {
      "type": "paragraph",
      "content": "Learn more about [media types](https://help.shopify.com/en/manual/products/product-media)."
    },
    {
      "type": "checkbox",
      "id": "modal-enabled",
      "label": "Enable modal popup",
      "default": true,
      "info": "Opens when clicking a product image"
    },
    {
      "type": "checkbox",
      "id": "hide-variant-media",
      "label": "Hide variant media",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "loop-enabled",
      "label": "Enable video looping",
      "default": false
    },
    {
      "type": "header",
      "content": "Size chart"
    },
    {
      "type": "checkbox",
      "id": "product-size-chart-enabled",
      "label": "Enable",
      "default": false
    },
    {
      "type": "text",
      "id": "product-size-chart-option",
      "label": "Link from option",
      "default": "size"
    },
    {
      "type": "page",
      "id": "product-size-chart-page-content",
      "label": "Page content"
    }
  ]
}
{% endschema %}